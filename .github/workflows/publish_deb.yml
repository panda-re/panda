name: Publish deb package

on:
  push:
    branches:
      - dev
  pull_request:
    branches:
      - dev

jobs:
  build_deb:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        ubuntu_version:
          #TODO - 18.04
          - 20.04
          - 22.04
    steps:
      - uses: actions/checkout@v4
      - working-directory: panda/debian
        run: ./setup.sh Ubuntu ${{ matrix.ubuntu_version }}
      - name: Publish to panda.re
        if: github.ref == 'refs/heads/dev'
        uses: easingthemes/ssh-deploy@main
        with:
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
          SOURCE: panda/debian/pandare.deb
          REMOTE_HOST: panda.re
          REMOTE_USER: github
          TARGET: /var/www/secret/pandare_${{ matrix.ubuntu_version }}.deb